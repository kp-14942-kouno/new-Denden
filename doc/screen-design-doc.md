# コール業務管理システム 画面設計書

## 目次
1. [画面一覧](#1-画面一覧)
2. [画面遷移図](#2-画面遷移図)
3. [ログイン画面](#3-ログイン画面)
4. [メイン画面](#4-メイン画面)
5. [共通UI要素](#5-共通ui要素)
6. [操作フロー](#6-操作フロー)
7. [エラー処理](#7-エラー処理)
8. [画面レイアウト詳細](#8-画面レイアウト詳細)

---

## 1. 画面一覧

| 画面ID | 画面名 | 概要 | 権限 |
|--------|--------|------|------|
| SCR-001 | ログイン画面 | システムへのログイン | 全ユーザー |
| SCR-002 | メイン画面 | 問合せ管理のメイン画面 | ログイン後 |

---

## 2. 画面遷移図

```
┌─────────────┐
│  起動       │
└──────┬──────┘
       │
       ↓
┌─────────────┐
│ ログイン画面 │ (SCR-001)
└──────┬──────┘
       │ ログイン成功
       ↓
┌─────────────┐
│ メイン画面   │ (SCR-002)
└──────┬──────┘
       │
       │ ログアウト
       ↓
┌─────────────┐
│ ログイン画面 │ (SCR-001)
└─────────────┘
```

---

## 3. ログイン画面

### 3.1 画面ID
SCR-001

### 3.2 画面概要
オペレーターがシステムにログインするための画面

### 3.3 レイアウト

```
┌────────────────────────────────────────────┐
│                                            │
│         📞 コール業務管理システム          │
│                                            │
│  ┌────────────────────────────────────┐   │
│  │                                    │   │
│  │  案件選択                          │   │
│  │  ┌──────────────────────────────┐ │   │
│  │  │ ▼ 案件A - サポートセンター   │ │   │
│  │  └──────────────────────────────┘ │   │
│  │                                    │   │
│  │  ログインID                        │   │
│  │  ┌──────────────────────────────┐ │   │
│  │  │                              │ │   │
│  │  └──────────────────────────────┘ │   │
│  │                                    │   │
│  │  パスワード                        │   │
│  │  ┌──────────────────────────────┐ │   │
│  │  │ ••••••••                     │ │   │
│  │  └──────────────────────────────┘ │   │
│  │                                    │   │
│  │  ┌──────────────────────────────┐ │   │
│  │  │        ログイン              │ │   │
│  │  └──────────────────────────────┘ │   │
│  │                                    │   │
│  └────────────────────────────────────┘   │
│                                            │
└────────────────────────────────────────────┘
```

### 3.4 UI要素

| 要素ID | 要素名 | 種類 | 必須 | 説明 |
|--------|--------|------|------|------|
| LGN-001 | 案件選択 | ComboBox | ◯ | 有効な案件をリスト表示 |
| LGN-002 | ログインID | TextBox | ◯ | オペレーターのログインID |
| LGN-003 | パスワード | PasswordBox | ◯ | パスワード（マスク表示） |
| LGN-004 | ログインボタン | Button | - | ログイン実行 |

### 3.5 表示条件

**案件選択コンボボックス**:
- ProjectMasterテーブルから IsActive = 1 の案件を取得
- ProjectName を表示
- デフォルト: 1件のみの場合は自動選択

### 3.6 イベント・動作

#### 3.6.1 ログインボタンクリック

**処理フロー**:
```
1. 入力チェック
   - 案件選択: 必須
   - ログインID: 必須
   - パスワード: 必須

2. 認証処理
   - OperatorMasterから該当レコードを検索
   - パスワードハッシュを比較（BCrypt）
   - IsActive = 1 をチェック

3. 成功時
   - セッション情報を保存
     - ProjectID
     - OperatorID
     - OperatorName
     - Role
   - メイン画面を表示
   - ログイン画面を閉じる

4. 失敗時
   - エラーメッセージ表示
   - 入力フィールドをクリア（パスワードのみ）
```

### 3.7 バリデーション

| 項目 | ルール | エラーメッセージ |
|------|--------|------------------|
| 案件選択 | 必須 | 案件を選択してください |
| ログインID | 必須、50文字以内 | ログインIDを入力してください |
| パスワード | 必須、255文字以内 | パスワードを入力してください |

### 3.8 エラーメッセージ

| エラーコード | メッセージ | 表示タイミング |
|-------------|-----------|---------------|
| ERR-LGN-001 | ログインIDまたはパスワードが正しくありません | 認証失敗時 |
| ERR-LGN-002 | このアカウントは無効化されています | IsActive = 0 の場合 |
| ERR-LGN-003 | データベースに接続できません | DB接続エラー |

---

## 4. メイン画面

### 4.1 画面ID
SCR-002

### 4.2 画面概要
問合せの登録・更新、顧客情報の参照を行うメイン画面

### 4.3 レイアウト（1870x1040px）

```
┌─────────────────────────────────────────────────────────────────────┐
│ ヘッダー (60px)                                                     │
│ 📞 案件A - サポートセンター | オペレーター: 山田太郎 | [ログアウト] │
├──────────────────────┬──────────────────────────────────────────────┤
│ 左パネル (600px)     │ 右パネル (1270px)                            │
│                      │                                              │
│ ┌──────────────────┐ │ ┌──────────────────────────────────────────┐ │
│ │ 検索エリア       │ │ │ 問合せ登録・更新                         │ │
│ │ (280px)          │ │ │                                          │ │
│ │                  │ │ │ 受電日時: 2024/01/09 15:30 (自動)       │ │
│ │ [顧客マスタ]     │ │ │ オペレーター: 山田太郎 (自動)           │ │
│ │ [カスタム項目]   │ │ │                                          │ │
│ │ [問合せ履歴]     │ │ │ カテゴリー: ▼                            │ │
│ │                  │ │ │ ステータス: ▼                            │ │
│ │ 顧客ID: [     ]  │ │ │                                          │ │
│ │ 顧客名: [     ]  │ │ │ 問合せ内容: *                            │ │
│ │ 電話番号:[     ]  │ │ │ ┌──────────────────────────────────┐   │ │
│ │                  │ │ │ │                                      │   │ │
│ │ [検索] [クリア]  │ │ │ └──────────────────────────────────┘   │ │
│ └──────────────────┘ │ │                                          │ │
│                      │ │ 対応内容:                                │ │
│ ┌──────────────────┐ │ │ ┌──────────────────────────────────┐   │ │
│ │ 検索結果         │ │ │ │                                      │   │ │
│ │ (150px)          │ │ │ └──────────────────────────────────┘   │ │
│ │                  │ │ │                                          │ │
│ │ 検索結果: 3件    │ │ │ カスタム項目:                            │ │
│ │                  │ │ │ 契約番号: [          ]                   │ │
│ │ ▼ 田中 花子      │ │ │ 対応期限: [          ]                   │ │
│ │   C-12345        │ │ │ 優先度:   ▼                              │ │
│ │                  │ │ │                                          │ │
│ │   佐藤 一郎      │ │ │ [既存履歴更新] [新規登録] [クリア]       │ │
│ │   C-12346        │ │ └──────────────────────────────────────────┘ │
│ └──────────────────┘ │                                              │
│                      │                                              │
│ ┌──────────────────┐ │                                              │
│ │ 顧客情報         │ │                                              │
│ │ (550px)          │ │                                              │
│ │                  │ │                                              │
│ │ [基本情報]       │ │                                              │
│ │ [契約情報]       │ │                                              │
│ │ [住所]           │ │                                              │
│ │ [その他]         │ │                                              │
│ │ [画像・メモ]     │ │                                              │
│ │                  │ │                                              │
│ │ 顧客ID           │ │                                              │
│ │ C-12345          │ │                                              │
│ │ ────────────     │ │                                              │
│ │ 顧客名           │ │                                              │
│ │ 田中 花子        │ │                                              │
│ │ ────────────     │ │                                              │
│ │ ...              │ │                                              │
│ │                  │ │                                              │
│ │ [顧客紐付け]     │ │                                              │
│ │ [画像]           │ │                                              │
│ │ [顧客メモ]       │ │                                              │
│ │ [過去履歴]       │ │                                              │
│ └──────────────────┘ │                                              │
└──────────────────────┴──────────────────────────────────────────────┘
```

### 4.4 UI要素詳細

#### 4.4.1 ヘッダーエリア (60px)

| 要素ID | 要素名 | 種類 | 説明 |
|--------|--------|------|------|
| HDR-001 | 案件名表示 | Label | 選択中の案件名を表示 |
| HDR-002 | オペレーター名表示 | Label | ログイン中のオペレーター名 |
| HDR-003 | ログアウトボタン | Button | ログアウト実行 |

#### 4.4.2 左パネル - 検索エリア (280px)

**タブ構成**:

| タブID | タブ名 | 表示条件 |
|--------|--------|----------|
| TAB-001 | 顧客マスタ | config.json で CustomerMaster.Enabled = true |
| TAB-002 | カスタム項目 | config.json で CustomFieldSearch.Enabled = true |
| TAB-003 | 問合せ履歴 | 常に表示 |

**TAB-001: 顧客マスタ検索**

| 要素ID | 要素名 | 種類 | 必須 | 説明 |
|--------|--------|------|------|------|
| CST-001 | 検索項目 | TextBox/ComboBox | - | config.json の SearchColumns に基づき動的生成 |
| CST-002 | 検索ボタン | Button | - | 検索実行 |
| CST-003 | クリアボタン | Button | - | 入力内容クリア |

**TAB-002: カスタム項目検索**

| 要素ID | 要素名 | 種類 | 必須 | 説明 |
|--------|--------|------|------|------|
| CUS-001 | 検索項目 | TextBox/ComboBox | - | CustomFieldDefinition で IsSearchable = 1 の項目を表示 |
| CUS-002 | 検索ボタン | Button | - | 検索実行 |
| CUS-003 | クリアボタン | Button | - | 入力内容クリア |

**TAB-003: 問合せ履歴検索**

| 要素ID | 要素名 | 種類 | 必須 | 説明 |
|--------|--------|------|------|------|
| HIS-001 | 受電日(開始) | DatePicker | - | 期間検索（開始） |
| HIS-002 | 受電日(終了) | DatePicker | - | 期間検索（終了） |
| HIS-003 | カテゴリー | ComboBox | - | CategoryMaster から取得 |
| HIS-004 | 対応状況 | ComboBox | - | StatusMaster から取得 |
| HIS-005 | オペレーター | ComboBox | - | OperatorMaster から取得 |
| HIS-006 | キーワード | TextBox | - | 問合せ内容・対応内容から検索 |
| HIS-007 | 検索ボタン | Button | - | 検索実行 |
| HIS-008 | クリアボタン | Button | - | 入力内容クリア |

#### 4.4.3 左パネル - 検索結果エリア (150px)

| 要素ID | 要素名 | 種類 | 説明 |
|--------|--------|------|------|
| RES-001 | 検索結果リスト | ListBox/ListView | 検索結果を表示、スクロール可能 |
| RES-002 | 件数表示 | Label | 検索結果件数 |

**検索結果の表示内容**:
- 顧客マスタ検索: 顧客名、顧客ID、電話番号
- カスタム項目検索: カスタム項目の値、受電日時
- 問合せ履歴検索: 受電日時、カテゴリー、顧客名

#### 4.4.4 左パネル - 顧客情報エリア (550px)

**タブ構成** (動的生成):

| タブID | タブ名 | 説明 |
|--------|--------|------|
| INFO-TAB-001~005 | グループ名 | CustomerMasterDisplayConfig から取得（最大5グループ） |

**表示内容**:

| 要素ID | 要素名 | 種類 | 説明 |
|--------|--------|------|------|
| INFO-001 | 項目リスト | ScrollViewer + StackPanel | 縦リスト形式で項目名と値を表示 |

**特別セクション**:

| 要素ID | 要素名 | 種類 | 表示条件 |
|--------|--------|------|----------|
| LINK-001 | 顧客紐付けセクション | Panel | 問合せ履歴編集中 かつ CustomerKey = NULL |
| IMG-001 | 画像セクション | Panel | 画像DBに画像がある場合 |
| MEMO-001 | 顧客メモセクション | Panel | 常に表示（管理者のみ編集可） |
| HIST-001 | 過去問合せ履歴セクション | Panel | 顧客が選択されている場合 |

#### 4.4.5 右パネル - 問合せ登録・更新エリア (1270px)

| 要素ID | 要素名 | 種類 | 必須 | 説明 |
|--------|--------|------|------|------|
| INQ-001 | 受電日時 | TextBox (ReadOnly) | - | 自動入力（現在日時） |
| INQ-002 | オペレーター | TextBox (ReadOnly) | - | 自動入力（ログイン中のオペレーター） |
| INQ-003 | カテゴリー | ComboBox | ◯ | CategoryMaster から取得 |
| INQ-004 | ステータス | ComboBox | ◯ | StatusMaster から取得 |
| INQ-005 | 問合せ内容 | TextBox (Multiline) | ◯ | 問合せ内容入力 |
| INQ-006 | 対応内容 | TextBox (Multiline) | - | 対応内容入力 |
| INQ-007 | カスタム項目 | 動的生成 | - | CustomFieldDefinition で IsEnabled = 1 の項目 |
| INQ-008 | 既存履歴更新ボタン | Button | - | UPDATE処理 |
| INQ-009 | 新規登録ボタン | Button | - | INSERT処理 |
| INQ-010 | クリアボタン | Button | - | 入力内容クリア |

### 4.5 画面表示時の処理

#### 4.5.1 初期表示

```
1. セッション情報から案件情報を取得
2. ヘッダーに案件名、オペレーター名を表示
3. マスタデータ取得
   - CategoryMaster
   - StatusMaster
   - CustomFieldDefinition
   - CustomerMasterDisplayConfig
4. config.json読み込み
5. タブの動的生成
   - 検索エリアのタブ
   - 顧客情報エリアのタブ
6. デフォルト値設定
   - 受電日時: 現在日時
   - オペレーター: ログイン中のオペレーター
```

### 4.6 イベント・動作

#### 4.6.1 検索ボタンクリック

**顧客マスタ検索**:
```
1. 入力チェック（少なくとも1項目入力）
2. 動的SQLクエリ構築
   - SearchColumns の設定に基づく
   - 検索方式（Exact / Partial）を適用
3. 顧客マスタDBから検索
4. 検索結果を検索結果エリアに表示
5. 1件の場合: 自動で顧客情報を表示
6. 複数件の場合: リストから選択
```

**カスタム項目検索**:
```
1. 入力チェック
2. InquiryHistory テーブルから検索
   - CustomCol01~10 から検索
   - IsSearchable = 1 の項目のみ
3. 検索結果を検索結果エリアに表示
4. 選択時: 問合せ履歴を右パネルに表示
5. CustomerKey があれば顧客情報も表示
```

**問合せ履歴検索**:
```
1. 検索条件に基づきクエリ構築
   - 期間、カテゴリー、ステータス等
2. InquiryHistory テーブルから検索
3. 検索結果を検索結果エリアに表示
4. 選択時: 問合せ履歴を右パネルに表示
5. CustomerKey があれば顧客情報も表示
```

#### 4.6.2 検索結果選択

**顧客マスタ検索結果を選択**:
```
1. 選択した顧客のキー取得
2. 顧客マスタから詳細情報取得
3. 顧客情報エリアに表示
   - グループごとのタブに分けて表示
4. 画像DBから画像情報取得（あれば）
5. CustomerMemo から顧客メモ取得（あれば）
6. InquiryHistory から過去問合せ取得
```

**カスタム項目/問合せ履歴検索結果を選択**:
```
1. 選択した問合せのデータを取得
2. 右パネルに問合せ内容を表示（編集モード）
3. CustomerKey があれば:
   - 顧客マスタから顧客情報取得
   - 顧客情報エリアに表示
4. CustomerKey がなければ:
   - 顧客情報エリアに「顧客紐付け」セクション表示
```

#### 4.6.3 新規登録ボタンクリック

```
1. バリデーション
   - 必須項目チェック
   - データ型チェック

2. データ準備
   - ProjectID: セッションから取得
   - CustomerKey: 選択中の顧客のキー（なければNULL）
   - OperatorID: セッションから取得
   - FirstReceivedDateTime: 受電日時
   - CreatedBy: OperatorID
   - CreatedAt: 現在日時

3. INSERT処理
   INSERT INTO InquiryHistory (...) VALUES (...)

4. 成功時
   - 成功メッセージ表示
   - 入力内容クリア（右パネルのみ）
   - 顧客情報は保持

5. 失敗時
   - エラーメッセージ表示
```

#### 4.6.4 既存履歴更新ボタンクリック

```
1. バリデーション

2. 履歴保存設定チェック
   IF HistoryLogSettings.EnableHistoryLog = 1 THEN
     - 更新前データを InquiryHistoryLog に INSERT
   END IF

3. UPDATE処理
   UPDATE InquiryHistory
   SET ...
   WHERE InquiryID = @InquiryID

4. 成功時
   - 成功メッセージ表示
   - 編集モード解除

5. 失敗時
   - エラーメッセージ表示
```

#### 4.6.5 顧客紐付けボタンクリック

```
前提: 問合せ履歴編集中 かつ 顧客が選択されている

1. 確認ダイアログ表示
   「この顧客を問合せ履歴に紐付けますか?」

2. OK時
   UPDATE InquiryHistory
   SET CustomerKey = @CustomerKey,
       UpdatedDateTime = GETDATE(),
       UpdatedBy = @OperatorID
   WHERE InquiryID = @InquiryID

3. 成功時
   - 顧客紐付けセクションを非表示
   - 顧客情報を表示

4. 失敗時
   - エラーメッセージ表示
```

#### 4.6.6 過去履歴を編集ボタンクリック

```
1. 選択した履歴のデータを取得
2. 右パネルに表示
   - 全項目に値をセット
3. モード変更
   - 新規登録ボタン: 無効化
   - 既存履歴更新ボタン: 有効化
4. InquiryID を保持（更新時に使用）
```

#### 4.6.7 ログアウトボタンクリック

```
1. 確認ダイアログ表示
   「ログアウトしますか? 入力中のデータは保存されません。」

2. OK時
   - セッション情報クリア
   - メイン画面を閉じる
   - ログイン画面を表示

3. キャンセル時
   - 何もしない
```

### 4.7 バリデーション

| 項目 | ルール | エラーメッセージ |
|------|--------|------------------|
| カテゴリー | 必須 | カテゴリーを選択してください |
| ステータス | 必須 | 対応状況を選択してください |
| 問合せ内容 | 必須、10文字以上 | 問合せ内容を10文字以上入力してください |
| カスタム項目 | IsRequired = 1 の場合必須 | {DisplayName}は必須です |

### 4.8 エラーメッセージ

| エラーコード | メッセージ | 表示タイミング |
|-------------|-----------|---------------|
| ERR-INQ-001 | 問合せ内容は必須です | バリデーションエラー |
| ERR-INQ-002 | 登録に失敗しました | INSERT/UPDATE失敗時 |
| ERR-INQ-003 | 顧客情報の取得に失敗しました | 顧客マスタ検索失敗時 |
| ERR-INQ-004 | 検索に失敗しました | 検索処理失敗時 |

---

## 5. 共通UI要素

### 5.1 ボタンスタイル

| ボタン種類 | 背景色 | 文字色 | 用途 |
|-----------|--------|--------|------|
| Primary | #2563eb (青) | 白 | 主要操作（検索、登録） |
| Success | #16a34a (緑) | 白 | 確定操作（新規登録） |
| Warning | #f59e0b (オレンジ) | 白 | 更新操作 |
| Secondary | #e5e7eb (グレー) | 黒 | キャンセル、クリア |

### 5.2 フォントサイズ

| 用途 | サイズ |
|------|--------|
| タイトル | 20px |
| 見出し | 16px |
| 本文 | 13px |
| ラベル | 13px |
| 補足 | 11px |

### 5.3 余白・間隔

| 用途 | サイズ |
|------|--------|
| パネル間 | 20px |
| セクション間 | 15px |
| 項目間 | 10px |
| ボタン間 | 10px |

---

## 6. 操作フロー

### 6.1 基本操作フロー

```
起動
  ↓
ログイン
  ↓
メイン画面表示
  ↓
┌─────────────────────────┐
│ 新規問合せ登録フロー    │
├─────────────────────────┤
│ 1. 顧客検索              │
│ 2. 顧客選択              │
│ 3. 問合せ内容入力        │
│ 4. 新規登録ボタン        │
│ 5. 完了                  │
└─────────────────────────┘

┌─────────────────────────┐
│ 既存履歴更新フロー      │
├─────────────────────────┤
│ 1. 顧客検索 or 履歴検索  │
│ 2. 履歴選択              │
│ 3. 内容編集              │
│ 4. 既存履歴更新ボタン    │
│ 5. 完了                  │
└─────────────────────────┘

┌─────────────────────────┐
│ 顧客紐付けフロー        │
├─────────────────────────┤
│ 1. カスタム項目検索      │
│ 2. 問合せ選択            │
│    (CustomerKey = NULL)  │
│ 3. 顧客マスタ検索        │
│ 4. 顧客選択              │
│ 5. 顧客紐付けボタン      │
│ 6. 完了                  │
└─────────────────────────┘
```

### 6.2 検索パターン別フロー

#### 6.2.1 顧客マスタ検索フロー

```
顧客マスタ検索タブ選択
  ↓
検索条件入力（顧客ID、顧客名など）
  ↓
検索ボタンクリック
  ↓
検索結果表示
  ↓
┌─ 1件の場合 ───────────┐
│ 自動で顧客情報表示     │
│ 過去問合せ履歴表示     │
└────────────────────────┘
  ↓
┌─ 複数件の場合 ────────┐
│ リストから選択         │
│ → 顧客情報表示        │
│ → 過去問合せ履歴表示  │
└────────────────────────┘
```

#### 6.2.2 カスタム項目検索フロー

```
カスタム項目検索タブ選択
  ↓
検索条件入力（発信者名、電話番号など）
  ↓
検索ボタンクリック
  ↓
検索結果表示（過去の問合せ履歴）
  ↓
リストから選択
  ↓
問合せ内容を右パネルに表示（編集モード）
  ↓
┌─ CustomerKey あり ────┐
│ 顧客情報も表示         │
└────────────────────────┘
  ↓
┌─ CustomerKey なし ────┐
│ 顧客紐付けセクション表示│
└────────────────────────┘
```

#### 6.2.3 問合せ履歴検索フロー

```
問合せ履歴検索タブ選択
  ↓
検索条件入力（期間、カテゴリーなど）
  ↓
検索ボタンクリック
  ↓
検索結果表示
  ↓
リストから選択
  ↓
問合せ内容を右パネルに表示（編集モード）
  ↓
顧客情報を左パネルに表示（あれば）
```

---

## 7. エラー処理

### 7.1 エラー表示方法

| エラーレベル | 表示方法 | 例 |
|-------------|---------|-----|
| 情報 | メッセージボックス（Information） | 登録が完了しました |
| 警告 | メッセージボックス（Warning） | 入力内容がクリアされます |
| エラー | メッセージボックス（Error） | 登録に失敗しました |
| 致命的エラー | メッセージボックス + アプリ終了 | データベースに接続できません |

### 7.2 バリデーションエラー

**表示タイミング**: フォーカスアウト時 or ボタンクリック時

**表示方法**:
- エラー項目を赤枠で囲む
- エラーメッセージをツールチップまたはラベルで表示

**例**:
```
┌──────────────────────┐
│ 問合せ内容 *         │
├──────────────────────┤ ← 赤枠
│                      │
└──────────────────────┘
  ↑ 問合せ内容は必須です（赤文字）
```

### 7.3 データベースエラー

**処理**:
```
1. エラーログに記録
   - エラー内容
   - 発生日時
   - オペレーター
   - 処理内容

2. ユーザーにエラー表示
   - 一般的なメッセージ
   - 「システム管理者に連絡してください」

3. 例外処理
   - トランザクションロールバック
   - リソース解放
```

### 7.4 ネットワークエラー

**データベース接続エラー**:
```
エラーメッセージ:
「データベースに接続できません。
ネットワーク接続を確認してください。」

対応:
- 再試行ボタン表示
- 3回失敗でアプリケーション終了
```

---

## 8. 画面レイアウト詳細

### 8.1 左パネル詳細

#### 8.1.1 検索エリア（280px）

**タブヘッダー**:
```
高さ: 40px
┌─────────────────────────────────────┐
│ [顧客マスタ] [カスタム項目] [問合せ履歴] │
└─────────────────────────────────────┘
```

**検索フォーム**:
```
高さ: 200px
余白: 15px

┌─────────────────────────────────────┐
│ 顧客ID: [                         ] │ ← 10px間隔
│ 顧客名: [                         ] │
│ 電話番号: [                       ] │
│                                     │
│ [検索]  [クリア]  ← 10px間隔       │
└─────────────────────────────────────┘
```

#### 8.1.2 検索結果エリア（150px）

```
余白: 10px

┌─────────────────────────────────────┐
│ 検索結果: 3件                       │
├─────────────────────────────────────┤
│ ▼ 田中 花子          ← 選択中は背景色 │
│   C-12345                           │
│   03-1234-5678                      │
│                                     │
│   佐藤 一郎                         │
│   C-12346                           │
│   03-2345-6789                      │
│                                     │
│   山本 次郎                         │
│   C-12347                           │
│   03-3456-7890                      │
└─────────────────────────────────────┘
```

**1件あたりの高さ**: 約45px

#### 8.1.3 顧客情報エリア（550px）

**タブヘッダー**:
```
高さ: 40px
固定表示（スクロール時も表示）

┌─────────────────────────────────────┐
│ [基本情報] [契約情報] [住所] [その他] [画像・メモ] │
└─────────────────────────────────────┘
```

**情報表示部分**:
```
高さ: 510px（スクロール可能）
余白: 15px

┌─────────────────────────────────────┐
│ 顧客ID                              │
│ C-12345                             │
│ ──────────────────────────────────  │ ← 区切り線
│ 顧客名                              │
│ 田中 花子                           │
│ ──────────────────────────────────  │
│ ...                                 │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🔗 顧客紐付け                   │ │ ← セクション
│ │ この顧客を問合せに紐付けますか? │ │
│ │ [この顧客と紐付ける]             │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 📷 関連画像                     │ │
│ │ [画像1] [画像2]                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 📝 顧客メモ(管理者のみ編集可)   │ │
│ │ VIP顧客。対応時は丁寧に。       │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 📋 過去問合せ履歴               │ │
│ │                                 │ │
│ │ 2024/01/08 14:30                │ │
│ │ 料金に関する問合せ              │ │
│ │ [この履歴を編集]                │ │
│ │ ─────────────                  │ │
│ │ ...                             │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 8.2 右パネル詳細（1270px）

```
余白: 20px
内部幅: 1230px

┌────────────────────────────────────────┐
│ 問合せ登録・更新                       │ ← タイトル
├────────────────────────────────────────┤
│                                        │
│ [受電日時]  [オペレーター]             │ ← 2列グリッド
│ [カテゴリー] [ステータス]              │
│                                        │
│ 問合せ内容: *                          │ ← 1列
│ ┌──────────────────────────────────┐  │
│ │                                  │  │ ← 高さ100px
│ │                                  │  │
│ └──────────────────────────────────┘  │
│                                        │
│ 対応内容:                              │
│ ┌──────────────────────────────────┐  │
│ │                                  │  │ ← 高さ100px
│ │                                  │  │
│ └──────────────────────────────────┘  │
│                                        │
│ ┌────────────────────────────────┐    │
│ │ カスタム項目                   │    │ ← セクション
│ │ [契約番号] [対応期限] [優先度] │    │ ← 2列グリッド
│ └────────────────────────────────┘    │
│                                        │
│ [既存履歴更新] [新規登録] [クリア]     │ ← ボタン
└────────────────────────────────────────┘
```

**項目間隔**: 15px
**ボタン間隔**: 10px

---

## 9. レスポンシブ対応

### 9.1 最小解像度

**対応解像度**: 1920x1080（実質1870x1040）

**最小解像度以下の場合**:
- 警告メッセージ表示
- 「推奨解像度: 1920x1080以上」

### 9.2 ウィンドウサイズ変更

**固定サイズ**: 1870x1040
**リサイズ**: 無効化

---

## 10. キーボードショートカット

| キー | 機能 | 画面 |
|------|------|------|
| Enter | ログイン実行 | ログイン画面 |
| F2 | 検索エリアにフォーカス | メイン画面 |
| F3 | 問合せ内容にフォーカス | メイン画面 |
| Ctrl + S | 新規登録 / 更新実行 | メイン画面 |
| Ctrl + N | 入力クリア | メイン画面 |
| Esc | 編集モード解除 | メイン画面 |
| Alt + F4 | アプリケーション終了 | 全画面 |

---

## 11. アクセシビリティ

### 11.1 タブオーダー

**ログイン画面**:
```
1. 案件選択
2. ログインID
3. パスワード
4. ログインボタン
```

**メイン画面（左パネル）**:
```
1. 検索タブ
2. 検索項目（上から順）
3. 検索ボタン
4. クリアボタン
5. 検索結果リスト
6. 顧客情報タブ
```

**メイン画面（右パネル）**:
```
1. カテゴリー
2. ステータス
3. 問合せ内容
4. 対応内容
5. カスタム項目（上から順）
6. 新規登録ボタン
7. 既存履歴更新ボタン
8. クリアボタン
```

### 11.2 フォーカス表示

- フォーカスのある要素: 青枠で囲む
- フォーカス移動: Tabキー / Shift + Tab

### 11.3 ツールチップ

**表示条件**: マウスオーバー1秒後

**表示内容**:
- アイコンボタン: 機能説明
- 無効化ボタン: 無効化理由
- 省略されたテキスト: 全文表示

---

## 12. 画面キャプチャ（参考）

### 12.1 ログイン画面

```
推奨サイズ: 500x400
配置: 画面中央
背景: グラデーション（青系）
```

### 12.2 メイン画面

```
サイズ: 1870x1040
配置: 画面中央
最大化: 不可
最小化: 可
```

---

## 13. ローディング表示

### 13.1 データ取得中

**表示タイミング**:
- 検索実行中
- 顧客情報取得中
- 問合せ履歴取得中

**表示方法**:
```
┌────────────────────────┐
│                        │
│   ⏳ データ取得中...  │
│                        │
└────────────────────────┘
```

**位置**: 該当エリアの中央

### 13.2 処理実行中

**表示タイミング**:
- 登録処理中
- 更新処理中
- 削除処理中

**表示方法**:
```
┌────────────────────────┐
│                        │
│   ⏳ 処理中...         │
│                        │
└────────────────────────┘
```

**位置**: 画面中央（モーダル）
**操作**: 処理完了まで他の操作を無効化

---

## 14. 確認ダイアログ

### 14.1 ログアウト確認

```
┌────────────────────────────────────┐
│ 確認                               │
├────────────────────────────────────┤
│                                    │
│ ログアウトしますか?                │
│ 入力中のデータは保存されません。   │
│                                    │
│         [OK]    [キャンセル]       │
└────────────────────────────────────┘
```

### 14.2 クリア確認

```
┌────────────────────────────────────┐
│ 確認                               │
├────────────────────────────────────┤
│                                    │
│ 入力内容をクリアしますか?          │
│                                    │
│         [OK]    [キャンセル]       │
└────────────────────────────────────┘
```

### 14.3 顧客紐付け確認

```
┌────────────────────────────────────┐
│ 確認                               │
├────────────────────────────────────┤
│                                    │
│ この顧客を問合せ履歴に紐付けますか?│
│                                    │
│ 顧客: 田中 花子 (C-12345)         │
│                                    │
│         [OK]    [キャンセル]       │
└────────────────────────────────────┘
```

---

## 15. 成功メッセージ

### 15.1 登録成功

```
┌────────────────────────────────────┐
│ 情報                               │
├────────────────────────────────────┤
│                                    │
│ 問合せを登録しました。             │
│                                    │
│              [OK]                  │
└────────────────────────────────────┘
```

### 15.2 更新成功

```
┌────────────────────────────────────┐
│ 情報                               │
├────────────────────────────────────┤
│                                    │
│ 問合せを更新しました。             │
│                                    │
│              [OK]                  │
└────────────────────────────────────┘
```

### 15.3 紐付け成功

```
┌────────────────────────────────────┐
│ 情報                               │
├────────────────────────────────────┤
│                                    │
│ 顧客を紐付けました。               │
│                                    │
│              [OK]                  │
└────────────────────────────────────┘
```

---

## 16. 画面状態管理

### 16.1 画面モード

| モード | 説明 | ボタン状態 |
|--------|------|-----------|
| 初期状態 | 画面表示直後 | 新規登録: 有効<br>既存履歴更新: 無効 |
| 新規入力中 | 問合せ内容を入力中 | 新規登録: 有効<br>既存履歴更新: 無効 |
| 編集中 | 既存履歴を編集中 | 新規登録: 無効<br>既存履歴更新: 有効 |

### 16.2 状態遷移

```
初期状態
  ↓
  ├→ 問合せ内容入力 → 新規入力中
  │
  └→ 過去履歴選択 → 編集中
       ↓
       └→ クリアボタン → 初期状態
```

---

## 17. データバインディング

### 17.1 コンボボックス

**カテゴリー**:
```
ItemsSource: CategoryMaster (IsActive = 1)
DisplayMemberPath: CategoryName
SelectedValuePath: CategoryID
```

**ステータス**:
```
ItemsSource: StatusMaster (IsActive = 1)
DisplayMemberPath: StatusName
SelectedValuePath: StatusID
```

**カスタム項目（Select型）**:
```
ItemsSource: CustomFieldDefinition.SelectOptions (JSON解析)
SelectedValue: InquiryHistory.CustomColXX
```

### 17.2 検索結果リスト

**顧客マスタ検索**:
```
ItemsSource: ObservableCollection<CustomerSearchResult>
DisplayTemplate: 
  - 顧客名（太字）
  - 顧客ID + 電話番号（灰色）
```

**問合せ履歴検索**:
```
ItemsSource: ObservableCollection<InquirySearchResult>
DisplayTemplate:
  - 受電日時（太字）
  - カテゴリー + ステータス（灰色）
```

---

## 18. パフォーマンス考慮事項

### 18.1 遅延読み込み

**顧客情報タブ**:
- タブ選択時に初めて表示内容を生成
- 非表示タブはデータ取得しない

**過去問合せ履歴**:
- 初回表示: 最新10件のみ取得
- スクロール時: 追加で10件ずつ取得（仮想化）

### 18.2 キャッシュ

**マスタデータ**:
- CategoryMaster, StatusMaster: 起動時に取得、メモリキャッシュ
- 有効期限: セッション中は保持

**顧客情報**:
- 最近表示した5件をキャッシュ
- 同じ顧客を再選択時はキャッシュから取得

---

## 改訂履歴

| 版数 | 日付 | 改訂内容 | 作成者 |
|------|------|----------|--------|
| 1.0 | 2025/01/12 | 初版作成 | - |

---
